# 사용 SUM(attack_count) 순위/양/비율
WITH one as (
    SELECT weapon_name,
           SUM(attack_count) sum_attack_count,
           RANK() OVER (ORDER BY SUM(attack_count) DESC) rank_attack_count
    FROM kr_weapons
    GROUP BY weapon_name
    ),
    total as(
         SELECT SUM(attack_count) total
         FROM kr_weapons
    )

SELECT one.weapon_name,
       one.rank_attack_count,
       one.sum_attack_count,
       ROUND(one.sum_attack_count/total.total*100,2) rate_attack_count
FROM one, total
ORDER BY one.rank_attack_count
LIMIT 4
